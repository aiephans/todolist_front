<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Vulnerable TodoList</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-shield-exclamation"></i>
                Vulnerable TodoList
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3" id="userInfo">
                    <i class="bi bi-person-circle"></i>
                    <span id="username">Usuario</span>
                </span>
                <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Welcome Section -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <h2 class="card-title text-primary">
                            <i class="bi bi-list-task"></i> 
                            Mi Lista de Tareas
                        </h2>
                        <p class="card-text text-muted">
                            Gestiona tus tareas de manera sencilla. 
                            <span class="badge bg-warning text-dark">
                                <i class="bi bi-exclamation-triangle"></i> 
                                Aplicación con vulnerabilidades educativas
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-plus-circle"></i> 
                            Agregar Nueva Tarea
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="addTaskForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="taskTitle" class="form-label">
                                        <i class="bi bi-card-text"></i> Título
                                    </label>
                                    <input type="text" class="form-control" id="taskTitle" name="title" required placeholder="Ingresa el título de la tarea">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="taskDescription" class="form-label">
                                        <i class="bi bi-file-text"></i> Descripción
                                    </label>
                                    <textarea class="form-control" id="taskDescription" name="description" rows="1" placeholder="Descripción opcional"></textarea>
                                </div>
                            </div>
                            <div class="d-grid d-md-flex justify-content-md-end">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-plus-lg"></i> Agregar Tarea
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="row mb-3">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchTasks" placeholder="Buscar tareas...">
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" id="filterTasks">
                    <option value="all">Todas las tareas</option>
                    <option value="pending">Pendientes</option>
                    <option value="completed">Completadas</option>
                </select>
            </div>
        </div>

        <!-- Tasks List Section -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul"></i> 
                            Mis Tareas
                        </h5>
                        <span class="badge bg-primary fs-6 px-3 py-2" id="taskCount">0 tareas</span>
                    </div>
                    <div class="card-body p-0">
                        <!-- Loading indicator -->
                        <div id="loadingIndicator" class="text-center p-4">
                            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                            <p class="mt-2 text-muted">Cargando tareas...</p>
                        </div>

                        <!-- Tasks container -->
                        <div id="tasksContainer" class="list-group list-group-flush" style="display: none;">
                            <!-- Tasks will be dynamically loaded here -->
                        </div>

                        <!-- Empty state -->
                        <div id="emptyState" class="text-center p-5" style="display: none;">
                            <i class="bi bi-inbox display-1 text-muted opacity-25"></i>
                            <h4 class="text-muted mt-3">No hay tareas</h4>
                            <p class="text-muted">¡Agrega tu primera tarea usando el formulario de arriba!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert area for messages -->
        <div id="alertArea" class="mt-3"></div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content shadow">
                <div class="modal-header bg-light">
                    <h5 class="modal-title">
                        <i class="bi bi-pencil-square"></i> 
                        Editar Tarea
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="editTaskForm">
                    <div class="modal-body">
                        <input type="hidden" id="editTaskId" name="taskId">
                        <div class="mb-3">
                            <label for="editTaskTitle" class="form-label">
                                <i class="bi bi-card-text"></i> Título
                            </label>
                            <input type="text" class="form-control" id="editTaskTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDescription" class="form-label">
                                <i class="bi bi-file-text"></i> Descripción
                            </label>
                            <textarea class="form-control" id="editTaskDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editTaskCompleted" name="completed">
                            <label class="form-check-label" for="editTaskCompleted">
                                <i class="bi bi-check-circle"></i> Tarea completada
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-lg"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg"></i> Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content shadow">
                <div class="modal-header bg-light">
                    <h5 class="modal-title text-danger">
                        <i class="bi bi-trash"></i> 
                        Eliminar Tarea
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que deseas eliminar esta tarea?</p>
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Esta acción no se puede deshacer.</strong>
                    </div>
                    <div id="taskToDelete" class="border p-2 rounded bg-light">
                        <!-- Task details will be shown here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-lg"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Educational Warning Footer -->
    <footer class="bg-warning text-dark mt-auto py-3">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Advertencia Educativa:</strong> 
                    Esta aplicación contiene vulnerabilidades de seguridad intencionalmente implementadas para propósitos de aprendizaje.
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>